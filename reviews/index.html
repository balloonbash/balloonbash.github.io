<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customer Reviews | Balloon Bash</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- USE YOUR EXISTING CSS -->
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>

<body>
  <div id="header"></div>

  <main class="container">
    <h1>Customer Reviews</h1>
    <p class="text-muted">
      Feedback from customers who trusted us with their special moments.
    </p>

    <!-- REVIEW -->
    <div class="card">
      <div class="card-body">
        <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
        <p>
         "We engaged BalloonBash for a small family celebration and honestly didnâ€™t expect it to turn out this good. From the first message, they were patient, responsive, and really tried to understand what we wanted instead of pushing a fixed package.
          The balloons were beautifully arranged, colours matched perfectly, and everything looked even better than the reference photos we shared. Setup was smooth and on time, which really helped reduce our stress on the day.
          You can tell they genuinely care about their work. Will definitely recommend BalloonBash to friends and wonâ€™t hesitate to use them again for future events!"
        </p>
        <small>â€” Amanda Lim </small>
      </div>
    </div>

    <!-- REVIEW -->
    <div class="card">
      <div class="card-body">
        <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
        <p>
          â€œBig thank you to BalloonBash for making our event feel extra special! We had a rough idea in mind, but they helped refine it and suggested designs that suited the space really well.
          The end result was elegant, clean, and very Instagram-worthy ğŸ˜„ Guests kept asking where we got the balloons from. Communication was easy throughout, pricing was transparent, and there were no last-minute surprises.
          If youâ€™re looking for someone reliable who puts in real effort and pride into their balloon setups, BalloonBash is a great choice.â€
        </p>
        <small>â€” Daniel Tan</small>
      </div>
    </div>
     <!-- Test REVIEW Automation -->
    <div id="reviews-list"></div>
    
    <div style="margin-top:24px">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSfV43uDkA-vfEEXlZNdDcbeAl3PT2jdbiArUW7WMJqktRFBeQ/viewform" class="btn btn-primary">Leave a Review</a>
    </div>
  </main>
<script>
  // Load header (user pages site, root-based paths)
  fetch("/partials/header.html")
    .then(r => r.text())
    .then(html => document.getElementById("header").innerHTML = html)
    .catch(err => console.error("Header load error:", err));

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }

  async function loadLatestReviews() {
    const owner = "balloonbash";
    const repo  = "balloonbash.github.io";
    const folder = "reviews";

    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${folder}`;
    const res = await fetch(apiUrl, {
      headers: { "Accept": "application/vnd.github+json" }
    });

    if (!res.ok) {
      throw new Error("Failed to list reviews folder: " + res.status);
    }

    const files = await res.json();

    // Look for files like data-1734920000.json
    const candidates = files
      .filter(f => f.type === "file" && /^data-\d+\.json$/i.test(f.name))
      .sort((a, b) => {
        const ta = Number(a.name.match(/^data-(\d+)\.json$/i)[1]);
        const tb = Number(b.name.match(/^data-(\d+)\.json$/i)[1]);
        return tb - ta; // newest first
      });

    if (candidates.length === 0) return [];

    const latest = candidates[0];
    const jsonRes = await fetch(latest.download_url);
    if (!jsonRes.ok) {
      throw new Error("Failed to fetch latest reviews JSON");
    }

    return await jsonRes.json();
  }

  async function renderReviews() {
    const list = document.getElementById("reviews-list");
    list.innerHTML = "";

    try {
      const reviews = await loadLatestReviews();

      if (!Array.isArray(reviews) || reviews.length === 0) {
        list.innerHTML = `
          <div class="card">
            <div class="card-body">
              <p class="muted">No reviews yet.</p>
            </div>
          </div>`;
        return;
      }

      reviews.forEach(rv => {
        const ratingNum = Math.max(0, Math.min(5, Number(rv.rating) || 0));
        const stars = "â˜…â˜…â˜…â˜…â˜…".slice(0, ratingNum);

        const card = document.createElement("div");
        card.className = "card";
        card.style.marginBottom = "12px";
        card.innerHTML = `
          <div class="card-body">
            <div class="stars" aria-label="${ratingNum} out of 5 stars">${stars}</div>
            <p>â€œ${escapeHtml(rv.review)}â€</p>
            <small>
              â€” ${escapeHtml(rv.eventType || rv.event || "")}
              ${rv.name ? ", " + escapeHtml(rv.name) : ""}
            </small>
          </div>`;
        list.appendChild(card);
      });

    } catch (e) {
      console.error(e);
      list.innerHTML = `
        <div class="card">
          <div class="card-body">
            <p class="muted">Reviews could not be loaded.</p>
          </div>
        </div>`;
    }
  }

  renderReviews();
</script>

  

  
</body>
</html>
